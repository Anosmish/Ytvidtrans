<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice Studio - Text to Speech & MP3 Download</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: var(--primary-color);
            border: none;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success-color);
            border: none;
        }
        
        .btn-success:hover {
            background: #22c55e;
            transform: translateY(-2px);
        }
        
        .voice-control-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #4cc9f0, #4361ee);
            outline: none;
            margin: 10px 0;
        }
        
        .voice-control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4361ee;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .stats-box {
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            border-left: 4px solid var(--primary-color);
            border-radius: 8px;
        }
        
        .audio-wave {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            margin: 20px 0;
        }
        
        .audio-bar {
            width: 4px;
            background: var(--primary-color);
            border-radius: 2px;
            animation: audioWave 1.5s ease-in-out infinite;
        }
        
        .audio-bar:nth-child(2) { animation-delay: 0.1s; }
        .audio-bar:nth-child(3) { animation-delay: 0.2s; }
        .audio-bar:nth-child(4) { animation-delay: 0.3s; }
        .audio-bar:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes audioWave {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            margin-bottom: 10px;
        }
        
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pulse-btn {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }
        
        .progress-bar-custom {
            height: 5px;
            background: linear-gradient(90deg, #4ade80, #3b82f6);
            border-radius: 3px;
            transition: width 0.3s ease;
            margin-top: 10px;
        }
        
        .file-info {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .glass-card {
                margin-bottom: 15px;
            }
            .btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
        }
        
        .download-progress {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .download-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #3b82f6);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4 text-center">
                    <h1 class="mb-2">
                        <i class="fas fa-microphone-alt me-2" style="color: #4361ee;"></i>
                        <span style="background: linear-gradient(135deg, #4361ee, #3a0ca3); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            AI Voice Studio
                        </span>
                    </h1>
                    <p class="text-muted mb-0">Advanced Text-to-Speech with Instant Playback & MP3 Download</p>
                </div>
            </div>
        </div>
        
        <div class="row">
            <!-- Left Sidebar -->
            <div class="col-lg-4 mb-4">
                <!-- Voice Settings -->
                <div class="glass-card p-3 mb-3">
                    <h5 class="mb-3">
                        <i class="fas fa-sliders-h me-2" style="color: #4361ee;"></i>
                        Voice Settings
                    </h5>
                    
                    <!-- Voice Selection -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Select Voice</label>
                        <select class="form-select" id="voiceSelect">
                            <option value="">Loading browser voices...</option>
                        </select>
                    </div>
                    
                    <!-- Voice Parameters -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-tachometer-alt me-1"></i>
                            Speed: <span id="rateValue" class="badge bg-primary">1.0x</span>
                        </label>
                        <input type="range" class="voice-control-slider" id="rateSlider" min="0.1" max="3" step="0.1" value="1.0">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-wave-square me-1"></i>
                            Pitch: <span id="pitchValue" class="badge bg-primary">1.0</span>
                        </label>
                        <input type="range" class="voice-control-slider" id="pitchSlider" min="0" max="2" step="0.1" value="1.0">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-volume-up me-1"></i>
                            Volume: <span id="volumeValue" class="badge bg-primary">100%</span>
                        </label>
                        <input type="range" class="voice-control-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1.0">
                    </div>
                    
                    <!-- Voice Presets -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Voice Presets</label>
                        <div class="row g-2">
                            <div class="col-4">
                                <button class="btn btn-outline-primary w-100 preset-btn" onclick="applyPreset('slow')">
                                    <i class="fas fa-turtle me-1"></i> Slow
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-primary w-100 preset-btn active" onclick="applyPreset('normal')">
                                    <i class="fas fa-user me-1"></i> Normal
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-primary w-100 preset-btn" onclick="applyPreset('fast')">
                                    <i class="fas fa-running me-1"></i> Fast
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Download MP3 -->
                <div class="glass-card p-3 mb-3">
                    <h5 class="mb-3">
                        <i class="fas fa-download me-2" style="color: #4361ee;"></i>
                        Download MP3
                    </h5>
                    
                    <div class="mb-3">
                        <button class="btn btn-success w-100 mb-2" onclick="downloadMP3()" id="downloadBtn">
                            <i class="fas fa-file-audio me-2"></i> Generate & Download MP3
                        </button>
                        
                        <!-- Download Progress -->
                        <div class="download-progress" id="downloadProgress" style="display: none;">
                            <div class="download-progress-bar" id="downloadProgressBar" style="width: 0%"></div>
                        </div>
                        
                        <!-- File Info -->
                        <div class="file-info" id="fileInfo" style="display: none;">
                            <div class="d-flex justify-content-between">
                                <small><i class="fas fa-file me-1"></i> <span id="fileName">speech.mp3</span></small>
                                <small><i class="fas fa-weight me-1"></i> <span id="fileSize">0 MB</span></small>
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="autoProcessDownload" checked>
                            <label class="form-check-label" for="autoProcessDownload">
                                <i class="fas fa-magic me-1"></i> Auto-process text
                            </label>
                        </div>
                        
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="spellCheckDownload" checked>
                            <label class="form-check-label" for="spellCheckDownload">
                                <i class="fas fa-spell-check me-1"></i> Auto spell check
                            </label>
                        </div>
                    </div>
                    
                    <div class="alert alert-info p-2">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            Downloads use server-side TTS. Limited to 2000 characters.
                        </small>
                    </div>
                </div>
                
                <!-- Text Tools -->
                <div class="glass-card p-3 mb-3">
                    <h5 class="mb-3">
                        <i class="fas fa-tools me-2" style="color: #4361ee;"></i>
                        Text Tools
                    </h5>
                    
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <button class="btn btn-outline-secondary w-100" onclick="processText('lowercase')">
                                <i class="fas fa-font me-1"></i> Lowercase
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-secondary w-100" onclick="processText('uppercase')">
                                <i class="fas fa-text-height me-1"></i> Uppercase
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-secondary w-100" onclick="processText('titlecase')">
                                <i class="fas fa-heading me-1"></i> Title Case
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-secondary w-100" onclick="processText('removeSpecial')">
                                <i class="fas fa-ban me-1"></i> No Special
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-info w-100" onclick="checkSpelling()">
                                <i class="fas fa-spell-check me-1"></i> Spell Check
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-info w-100" onclick="analyzeText()">
                                <i class="fas fa-chart-line me-1"></i> Analyze
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-success w-100" onclick="translateText()">
                                <i class="fas fa-language me-1"></i> Translate
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-warning w-100" onclick="testSpeechAPI()">
                                <i class="fas fa-test-tube me-1"></i> Test TTS
                            </button>
                        </div>
                    </div>
                    
                    <!-- Auto Processing Options -->
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="spellCheck" checked>
                        <label class="form-check-label" for="spellCheck">
                            <i class="fas fa-magic me-1"></i> Auto Spell Check
                        </label>
                    </div>
                    
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="cleanSpaces" checked>
                        <label class="form-check-label" for="cleanSpaces">
                            <i class="fas fa-broom me-1"></i> Clean Spaces
                        </label>
                    </div>
                    
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="autoCapitalize" checked>
                        <label class="form-check-label" for="autoCapitalize">
                            <i class="fas fa-paragraph me-1"></i> Auto Capitalize
                        </label>
                    </div>
                </div>
                
                <!-- Text Statistics -->
                <div class="glass-card p-3">
                    <h5 class="mb-3">
                        <i class="fas fa-chart-bar me-2" style="color: #4361ee;"></i>
                        Text Statistics
                    </h5>
                    
                    <div class="stats-box p-3">
                        <div class="row text-center">
                            <div class="col-4">
                                <h3 id="wordCount" class="fw-bold">0</h3>
                                <small class="text-muted">Words</small>
                            </div>
                            <div class="col-4">
                                <h3 id="charCount" class="fw-bold">0</h3>
                                <small class="text-muted">Chars</small>
                            </div>
                            <div class="col-4">
                                <h3 id="sentenceCount" class="fw-bold">0</h3>
                                <small class="text-muted">Sentences</small>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <div class="loading-spinner" id="loadingSpinner"></div>
                            <p class="mb-0" id="readingTime">
                                <i class="fas fa-clock me-1"></i> Reading time: 0 min
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Text Input Area -->
                <div class="glass-card p-4 mb-3">
                    <h5 class="mb-3">
                        <i class="fas fa-edit me-2" style="color: #4361ee;"></i>
                        Enter Your Text
                    </h5>
                    
                    <textarea class="form-control" id="textInput" rows="12" 
                              placeholder="Type or paste your text here... You can enter up to 2000 characters for MP3 download."></textarea>
                    
                    <div class="mt-3 d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            <span id="charCountDisplay">0/2000 characters</span>
                        </small>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" onclick="clearText()">
                                <i class="fas fa-trash me-1"></i> Clear
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="loadSampleText()">
                                <i class="fas fa-file-alt me-1"></i> Sample
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- TTS Controls -->
                <div class="glass-card p-4 mb-3">
                    <h5 class="mb-3">
                        <i class="fas fa-microphone me-2" style="color: #4361ee;"></i>
                        Speech Controls
                    </h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-4 mb-2">
                            <button class="btn btn-primary w-100 py-3 pulse-btn" onclick="generateVoice()" id="speakBtn">
                                <i class="fas fa-play-circle me-2"></i> Speak
                            </button>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button class="btn btn-warning w-100 py-3" onclick="togglePause()" id="pauseBtn">
                                <i class="fas fa-pause me-2"></i> Pause
                            </button>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button class="btn btn-danger w-100 py-3" onclick="stopSpeech()" id="stopBtn">
                                <i class="fas fa-stop me-2"></i> Stop
                            </button>
                        </div>
                    </div>
                    
                    <!-- Audio Wave Visualizer -->
                    <div id="audioWave" style="display: none;">
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                    </div>
                    
                    <!-- Status Messages -->
                    <div class="mt-3" id="statusMessage"></div>
                </div>
                
                <!-- Features Grid -->
                <div class="glass-card p-4 mb-3">
                    <h5 class="mb-3">
                        <i class="fas fa-star me-2" style="color: #4361ee;"></i>
                        Features
                    </h5>
                    
                    <div class="row text-center">
                        <div class="col-6 col-md-3 mb-3">
                            <div class="feature-icon mx-auto">
                                <i class="fas fa-microphone fa-lg"></i>
                            </div>
                            <h6>Browser TTS</h6>
                            <small class="text-muted">Instant Playback</small>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="feature-icon mx-auto">
                                <i class="fas fa-download fa-lg"></i>
                            </div>
                            <h6>MP3 Download</h6>
                            <small class="text-muted">High Quality</small>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="feature-icon mx-auto">
                                <i class="fas fa-language fa-lg"></i>
                            </div>
                            <h6>Translation</h6>
                            <small class="text-muted">100+ Languages</small>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="feature-icon mx-auto">
                                <i class="fas fa-spell-check fa-lg"></i>
                            </div>
                            <h6>Spell Check</h6>
                            <small class="text-muted">AI-Powered</small>
                        </div>
                    </div>
                </div>
                
                <!-- How It Works -->
                <div class="glass-card p-4">
                    <h5 class="mb-3">
                        <i class="fas fa-lightbulb me-2" style="color: #4361ee;"></i>
                        How It Works
                    </h5>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-2" 
                                     style="width: 50px; height: 50px;">
                                    <i class="fas fa-keyboard"></i>
                                </div>
                                <h6>1. Enter Text</h6>
                                <small class="text-muted">Type or paste your text</small>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <div class="rounded-circle bg-success text-white d-inline-flex align-items-center justify-content-center mb-2" 
                                     style="width: 50px; height: 50px;">
                                    <i class="fas fa-volume-up"></i>
                                </div>
                                <h6>2. Listen</h6>
                                <small class="text-muted">Click "Speak" for instant TTS</small>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <div class="rounded-circle bg-info text-white d-inline-flex align-items-center justify-content-center mb-2" 
                                     style="width: 50px; height: 50px;">
                                    <i class="fas fa-file-download"></i>
                                </div>
                                <h6>3. Download</h6>
                                <small class="text-muted">Get MP3 for offline use</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Dual TTS System:</strong> 
                        <span class="text-primary">Web Speech API</span> for instant playback + 
                        <span class="text-success">Server-side TTS</span> for MP3 downloads.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="glass-card p-3 text-center">
                    <p class="mb-0 text-muted">
                        <i class="fas fa-code me-1"></i> Built with Flask & pyttsx3 | 
                        <i class="fas fa-globe me-1 ms-2"></i> AI Voice Studio Â© 2024 |
                        <i class="fas fa-server me-1 ms-2"></i> Backend: Render | 
                        <i class="fas fa-cloud me-1 ms-2"></i> Frontend: Netlify
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let voices = [];
        let currentUtterance = null;
        let isSpeaking = false;
        let isPaused = false;
        
        // Backend URL
        const BACKEND_URL = 'https://ytvidtrans.onrender.com';
        
        // Web Speech API
        let speechSynthesis = window.speechSynthesis;
        let SpeechSynthesisUtterance = window.SpeechSynthesisUtterance;
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initSpeechSynthesis();
            setupEventListeners();
            updateTextStatistics();
            checkBackendHealth();
            checkSpeechSupport();
            checkTTSInfo();
            loadSampleText();
        });
        
        // Initialize Web Speech API
        function initSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                showMessage('Warning: Your browser does not support Web Speech API. TTS features will not work.', 'warning');
                disableTTSFeatures();
                return false;
            }
            
            // Load available browser voices
            loadBrowserVoices();
            
            // Voice changed event
            speechSynthesis.onvoiceschanged = function() {
                loadBrowserVoices();
            };
            
            return true;
        }
        
        // Load browser voices
        function loadBrowserVoices() {
            voices = speechSynthesis.getVoices();
            populateVoiceSelect();
        }
        
        // Populate voice select dropdown
        function populateVoiceSelect() {
            const voiceSelect = document.getElementById('voiceSelect');
            
            if (voices.length === 0) {
                voiceSelect.innerHTML = `
                    <option value="default">Default System Voice</option>
                    <option value="en-US">English (US)</option>
                    <option value="en-GB">English (UK)</option>
                `;
                return;
            }
            
            // Group voices by language
            const voicesByLang = {};
            voices.forEach(voice => {
                const lang = voice.lang || 'unknown';
                if (!voicesByLang[lang]) {
                    voicesByLang[lang] = [];
                }
                voicesByLang[lang].push(voice);
            });
            
            // Clear and populate
            voiceSelect.innerHTML = '<option value="">Select a voice...</option>';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = 'default';
            defaultOption.textContent = 'ðŸ”Š Default System Voice';
            voiceSelect.appendChild(defaultOption);
            
            // Add voices by language
            Object.keys(voicesByLang).sort().forEach(lang => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = `ðŸŒ ${lang}`;
                
                voicesByLang[lang].forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.voiceURI || lang;
                    option.textContent = `${voice.name} (${lang})`;
                    optgroup.appendChild(option);
                });
                
                voiceSelect.appendChild(optgroup);
            });
            
            // Select default voice
            if (voices.length > 0) {
                const defaultVoice = voices.find(v => v.default) || voices[0];
                voiceSelect.value = defaultVoice.voiceURI || 'default';
            }
        }
        
        // Check backend health
        async function checkBackendHealth() {
            try {
                console.log('Checking backend health...');
                const response = await fetch(`${BACKEND_URL}/api/health`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Backend status:', data.status);
                    showMessage(`âœ… Backend connected: ${data.backend_url}`, 'success');
                    return data;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.log('Backend not responding:', error);
                showMessage('âš ï¸ Backend connection issue. Some features may not work.', 'warning');
                return null;
            }
        }
        
        // Check TTS service info
        async function checkTTSInfo() {
            try {
                console.log('Checking TTS info from:', `${BACKEND_URL}/api/tts-info`);
                
                const response = await fetch(`${BACKEND_URL}/api/tts-info`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'omit'
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('TTS info check failed:', response.status, errorText);
                    
                    if (response.status === 405) {
                        console.log('Trying OPTIONS preflight...');
                        const optionsResponse = await fetch(`${BACKEND_URL}/api/tts-info`, {
                            method: 'OPTIONS',
                            mode: 'cors'
                        });
                        console.log('OPTIONS response:', optionsResponse.status);
                    }
                    
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('TTS info response:', data);
                
                if (!data.available) {
                    showMessage('âš ï¸ MP3 download service is currently unavailable', 'warning');
                    document.getElementById('downloadBtn').disabled = true;
                } else {
                    showMessage('âœ… TTS service available for MP3 download', 'success');
                    document.getElementById('downloadBtn').disabled = false;
                }
                
                return data;
            } catch (error) {
                console.error('Failed to check TTS info:', error);
                console.error('Error details:', error.message);
                
                // Don't disable download button on network errors
                return {
                    'engine': 'unknown',
                    'available': false,
                    'max_chars': 2000,
                    'rate_range': {'min': 50, 'max': 300, 'default': 150},
                    'volume_range': {'min': 0.1, 'max': 1.0, 'default': 1.0}
                };
            }
        }
        
        // Check speech support
        function checkSpeechSupport() {
            if (!('speechSynthesis' in window)) {
                showMessage('âŒ Your browser does not support Web Speech API. Please use Chrome, Edge, or Safari for TTS features.', 'danger');
                return false;
            }
            return true;
        }
        
        // Disable TTS features
        function disableTTSFeatures() {
            document.getElementById('speakBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('voiceSelect').disabled = true;
            document.getElementById('rateSlider').disabled = true;
            document.getElementById('pitchSlider').disabled = true;
            document.getElementById('volumeSlider').disabled = true;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            const textInput = document.getElementById('textInput');
            const rateSlider = document.getElementById('rateSlider');
            const pitchSlider = document.getElementById('pitchSlider');
            const volumeSlider = document.getElementById('volumeSlider');
            
            // Text input events
            textInput.addEventListener('input', updateTextStatistics);
            textInput.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    generateVoice();
                }
            });
            
            // Slider events
            rateSlider.addEventListener('input', function() {
                const rate = parseFloat(this.value);
                document.getElementById('rateValue').textContent = rate.toFixed(1) + 'x';
            });
            
            pitchSlider.addEventListener('input', function() {
                const pitch = parseFloat(this.value);
                document.getElementById('pitchValue').textContent = pitch.toFixed(1);
            });
            
            volumeSlider.addEventListener('input', function() {
                const volume = parseFloat(this.value);
                document.getElementById('volumeValue').textContent = Math.round(volume * 100) + '%';
            });
            
            // Check browser support on page load
            if (!checkSpeechSupport()) {
                disableTTSFeatures();
            }
        }
        
        // Apply voice preset
        function applyPreset(preset) {
            const rateSlider = document.getElementById('rateSlider');
            const pitchSlider = document.getElementById('pitchSlider');
            
            // Reset all preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active', 'btn-primary');
                btn.classList.add('btn-outline-primary');
            });
            
            // Mark clicked button as active
            event.currentTarget.classList.remove('btn-outline-primary');
            event.currentTarget.classList.add('btn-primary', 'active');
            
            switch(preset) {
                case 'slow':
                    rateSlider.value = 0.7;
                    pitchSlider.value = 0.8;
                    break;
                case 'normal':
                    rateSlider.value = 1.0;
                    pitchSlider.value = 1.0;
                    break;
                case 'fast':
                    rateSlider.value = 1.5;
                    pitchSlider.value = 1.2;
                    break;
            }
            
            // Update displays
            rateSlider.dispatchEvent(new Event('input'));
            pitchSlider.dispatchEvent(new Event('input'));
            
            showMessage(`Preset applied: ${preset}`, 'success');
        }
        
        // Process text with specific operation
        function processText(operation) {
            const textInput = document.getElementById('textInput');
            let text = textInput.value;
            
            switch(operation) {
                case 'lowercase':
                    text = text.toLowerCase();
                    showMessage('âœ… Converted to lowercase', 'success');
                    break;
                case 'uppercase':
                    text = text.toUpperCase();
                    showMessage('âœ… Converted to uppercase', 'success');
                    break;
                case 'titlecase':
                    text = text.toLowerCase().split(' ').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    showMessage('âœ… Converted to title case', 'success');
                    break;
                case 'removeSpecial':
                    text = text.replace(/[^\w\s.,!?-]/g, '');
                    showMessage('âœ… Removed special characters', 'success');
                    break;
            }
            
            textInput.value = text;
            updateTextStatistics();
        }
        
        // Clear text
        function clearText() {
            if (confirm('Are you sure you want to clear all text?')) {
                document.getElementById('textInput').value = '';
                updateTextStatistics();
                showMessage('Text cleared', 'info');
            }
        }
        
        // Load sample text
        function loadSampleText() {
            const sampleText = `Welcome to AI Voice Studio!

This is a sample text to demonstrate the text-to-speech capabilities. You can:
1. Listen to this text instantly using your browser's Web Speech API
2. Download it as an MP3 file for offline use
3. Translate it to other languages
4. Check spelling and grammar
5. Analyze text statistics

Try clicking the "Speak" button to hear this text, or "Download MP3" to get an audio file!`;
            
            document.getElementById('textInput').value = sampleText;
            updateTextStatistics();
            showMessage('ðŸ“ Sample text loaded', 'info');
        }
        
        // Update text statistics
        function updateTextStatistics() {
            const text = document.getElementById('textInput').value;
            const words = text.trim() ? text.trim().split(/\s+/) : [];
            const sentences = text.trim() ? text.split(/[.!?]+/).filter(s => s.trim()) : [];
            
            document.getElementById('wordCount').textContent = words.length;
            document.getElementById('charCount').textContent = text.length;
            document.getElementById('sentenceCount').textContent = sentences.length;
            
            // Update character count display
            const charCountDisplay = document.getElementById('charCountDisplay');
            charCountDisplay.textContent = `${text.length}/2000 characters`;
            
            // Color code based on length
            if (text.length > 2000) {
                charCountDisplay.style.color = '#ef4444';
                charCountDisplay.innerHTML += ' <i class="fas fa-exclamation-triangle"></i>';
            } else if (text.length > 1500) {
                charCountDisplay.style.color = '#f59e0b';
            } else {
                charCountDisplay.style.color = '#6b7280';
            }
            
            // Calculate reading time
            const readingTimeMinutes = words.length / 200;
            document.getElementById('readingTime').textContent = 
                `Reading time: ${readingTimeMinutes.toFixed(1)} min`;
        }
        
        // Check spelling
        async function checkSpelling() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showMessage('Please enter some text first', 'warning');
                return;
            }
            
            try {
                showLoading(true);
                
                const response = await fetch(`${BACKEND_URL}/api/spellcheck`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ text: text })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                if (result.total_suggestions > 0) {
                    let message = `Found ${result.total_suggestions} spelling suggestion(s):\n\n`;
                    result.suggestions.forEach((suggestion, index) => {
                        if (suggestion.word) {
                            message += `${index + 1}. "${suggestion.word}" â†’ ${suggestion.suggestions?.join(', ') || 'No suggestions'}\n`;
                        }
                    });
                    
                    if (confirm(message + "\n\nApply corrections?")) {
                        document.getElementById('textInput').value = result.corrected;
                        updateTextStatistics();
                        showMessage('âœ… Spelling corrections applied', 'success');
                    }
                } else {
                    showMessage('âœ… No spelling errors found!', 'success');
                }
                
                showLoading(false);
                
            } catch (error) {
                console.error('Spell check error:', error);
                showLoading(false);
                showMessage('âŒ Failed to check spelling: ' + error.message, 'danger');
            }
        }
        
        // Analyze text
        async function analyzeText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showMessage('Please enter text first', 'warning');
                return;
            }
            
            try {
                showLoading(true);
                showMessage('Analyzing text...', 'info');
                
                const response = await fetch(`${BACKEND_URL}/api/analyze`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ text: text })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                const metrics = result.metrics;
                const readability = result.readability;
                
                let message = `ðŸ“Š Text Analysis Results:\n\n`;
                message += `â€¢ Words: ${metrics.word_count}\n`;
                message += `â€¢ Characters: ${metrics.character_count}\n`;
                message += `â€¢ Sentences: ${metrics.sentence_count}\n`;
                message += `â€¢ Avg Word Length: ${metrics.average_word_length} characters\n`;
                message += `â€¢ Avg Sentence Length: ${metrics.average_sentence_length} words\n`;
                message += `â€¢ Reading Time: ${metrics.reading_time_minutes} minutes\n`;
                message += `â€¢ Readability Score: ${metrics.readability_score}/100\n`;
                message += `â€¢ Readability Level: ${readability}\n`;
                
                alert(message);
                
                showLoading(false);
                showMessage('âœ… Text analysis complete', 'success');
                
            } catch (error) {
                console.error('Analysis error:', error);
                showLoading(false);
                showMessage('âŒ Failed to analyze text: ' + error.message, 'danger');
            }
        }
        
        // Generate voice using Web Speech API
        async function generateVoice() {
            if (!checkSpeechSupport()) return;
            
            const text = document.getElementById('textInput').value.trim();
            const voiceSelect = document.getElementById('voiceSelect');
            const rate = parseFloat(document.getElementById('rateSlider').value);
            const pitch = parseFloat(document.getElementById('pitchSlider').value);
            const volume = parseFloat(document.getElementById('volumeSlider').value);
            
            if (!text) {
                showMessage('Please enter text first', 'warning');
                return;
            }
            
            if (!voiceSelect.value) {
                showMessage('Please select a voice', 'warning');
                return;
            }
            
            // If already speaking, stop first
            if (isSpeaking) {
                stopSpeech();
                return;
            }
            
            // Process text on backend if needed
            let finalText = text;
            const shouldProcess = document.getElementById('spellCheck').checked || 
                                 document.getElementById('cleanSpaces').checked ||
                                 document.getElementById('autoCapitalize').checked;
            
            if (shouldProcess) {
                try {
                    showLoading(true);
                    showMessage('ðŸ”„ Processing text on backend...', 'info');
                    
                    const response = await fetch(`${BACKEND_URL}/api/preprocess`, {
                        method: 'POST',
                        mode: 'cors',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            text: text,
                            options: {
                                clean_spaces: document.getElementById('cleanSpaces').checked,
                                capitalize_sentences: document.getElementById('autoCapitalize').checked,
                                remove_special: false
                            }
                        })
                    });
                    
                    const result = await response.json();
                    if (!result.error) {
                        finalText = result.processed;
                        if (result.changes.length > 0) {
                            showMessage(`âœ… Text processed: ${result.changes.join(', ')}`, 'success');
                        }
                    }
                    
                    showLoading(false);
                    
                } catch (error) {
                    console.error('Text processing error:', error);
                    showLoading(false);
                    // Continue with original text
                }
            }
            
            // Speak the text
            speakText(finalText, voiceSelect.value, rate, pitch, volume);
        }
        
        // Speak text using Web Speech API
        function speakText(text, voiceId, rate, pitch, volume) {
            if (!('speechSynthesis' in window)) {
                showMessage('âŒ Your browser does not support Text-to-Speech.', 'danger');
                return;
            }
            
            // Stop any ongoing speech
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            // Create utterance
            const utterance = new SpeechSynthesisUtterance(text);
            currentUtterance = utterance;
            
            // Set voice
            if (voiceId && voiceId !== 'default') {
                const selectedVoice = voices.find(v => v.voiceURI === voiceId);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                    utterance.lang = selectedVoice.lang;
                } else {
                    utterance.lang = voiceId; // Use as language code
                }
            }
            
            // Set speech parameters
            utterance.rate = rate;
            utterance.pitch = pitch;
            utterance.volume = volume;
            
            // Event handlers
            utterance.onstart = function() {
                isSpeaking = true;
                isPaused = false;
                document.getElementById('audioWave').style.display = 'flex';
                document.getElementById('speakBtn').innerHTML = '<i class="fas fa-stop me-2"></i> Stop';
                document.getElementById('speakBtn').classList.remove('btn-primary');
                document.getElementById('speakBtn').classList.add('btn-danger');
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause me-2"></i> Pause';
                document.getElementById('pauseBtn').classList.remove('btn-warning', 'btn-success');
                document.getElementById('pauseBtn').classList.add('btn-warning');
                showMessage('ðŸ”Š Speaking...', 'info');
            };
            
            utterance.onend = function() {
                isSpeaking = false;
                isPaused = false;
                document.getElementById('audioWave').style.display = 'none';
                document.getElementById('speakBtn').innerHTML = '<i class="fas fa-play-circle me-2"></i> Speak';
                document.getElementById('speakBtn').classList.remove('btn-danger');
                document.getElementById('speakBtn').classList.add('btn-primary');
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause me-2"></i> Pause';
                document.getElementById('pauseBtn').classList.remove('btn-warning', 'btn-success');
                document.getElementById('pauseBtn').classList.add('btn-warning');
                showMessage('âœ… Finished speaking', 'success');
            };
            
            utterance.onerror = function(event) {
                console.error('Speech synthesis error:', event);
                isSpeaking = false;
                isPaused = false;
                document.getElementById('audioWave').style.display = 'none';
                document.getElementById('speakBtn').innerHTML = '<i class="fas fa-play-circle me-2"></i> Speak';
                document.getElementById('speakBtn').classList.remove('btn-danger');
                document.getElementById('speakBtn').classList.add('btn-primary');
                showMessage('âŒ Speech error: ' + event.error, 'danger');
            };
            
            // Start speaking
            speechSynthesis.speak(utterance);
        }
        
        // Stop speech
        function stopSpeech() {
            if (speechSynthesis.speaking || isSpeaking) {
                speechSynthesis.cancel();
                isSpeaking = false;
                isPaused = false;
                document.getElementById('audioWave').style.display = 'none';
                document.getElementById('speakBtn').innerHTML = '<i class="fas fa-play-circle me-2"></i> Speak';
                document.getElementById('speakBtn').classList.remove('btn-danger');
                document.getElementById('speakBtn').classList.add('btn-primary');
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause me-2"></i> Pause';
                document.getElementById('pauseBtn').classList.remove('btn-warning', 'btn-success');
                document.getElementById('pauseBtn').classList.add('btn-warning');
                showMessage('â¹ï¸ Speech stopped', 'info');
            }
        }
        
        // Toggle pause/resume
        function togglePause() {
            if (!isSpeaking) return;
            
            if (speechSynthesis.paused) {
                speechSynthesis.resume();
                isPaused = false;
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause me-2"></i> Pause';
                document.getElementById('pauseBtn').classList.remove('btn-success');
                document.getElementById('pauseBtn').classList.add('btn-warning');
                showMessage('â–¶ï¸ Resumed speaking', 'info');
            } else {
                speechSynthesis.pause();
                isPaused = true;
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-play me-2"></i> Resume';
                document.getElementById('pauseBtn').classList.remove('btn-warning');
                document.getElementById('pauseBtn').classList.add('btn-success');
                showMessage('â¸ï¸ Paused', 'info');
            }
        }
        
        // Translate text
        async function translateText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showMessage('Please enter text first', 'warning');
                return;
            }
            
            const targetLang = prompt('Enter target language code (e.g., es, fr, de, hi, ja):', 'es');
            if (!targetLang) return;
            
            try {
                showLoading(true);
                showMessage('ðŸŒ Translating...', 'info');
                
                const response = await fetch(`${BACKEND_URL}/api/translate`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        target_lang: targetLang
                    })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                document.getElementById('textInput').value = result.translated;
                updateTextStatistics();
                
                showLoading(false);
                showMessage(`âœ… Translated from ${result.source_language} to ${result.target_language}`, 'success');
                
            } catch (error) {
                console.error('Translation error:', error);
                showLoading(false);
                showMessage('âŒ Failed to translate: ' + error.message, 'danger');
            }
        }
        
        // Download MP3 using backend TTS
        async function downloadMP3() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showMessage('Please enter text first', 'warning');
                return;
            }
            
            if (text.length > 2000) {
                showMessage('Text too long for MP3 download (max 2000 characters)', 'warning');
                return;
            }
            
            try {
                // Disable button and show loading
                const downloadBtn = document.getElementById('downloadBtn');
                const originalText = downloadBtn.innerHTML;
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Generating MP3...';
                downloadBtn.disabled = true;
                
                // Show progress bar
                const progressBar = document.getElementById('downloadProgress');
                const progressBarInner = document.getElementById('downloadProgressBar');
                progressBar.style.display = 'block';
                progressBarInner.style.width = '10%';
                
                showLoading(true);
                showMessage('ðŸŽµ Generating MP3 audio file...', 'info');
                
                // Get TTS settings
                const rate = parseInt(document.getElementById('rateSlider').value * 100);
                const volume = parseFloat(document.getElementById('volumeSlider').value);
                
                // Update progress
                progressBarInner.style.width = '30%';
                
                // Prepare request data
                const requestData = {
                    text: text,
                    rate: rate,
                    volume: volume,
                    preprocess: document.getElementById('autoProcessDownload').checked,
                    spell_check: document.getElementById('spellCheckDownload').checked,
                    processing_options: {
                        clean_spaces: document.getElementById('cleanSpaces').checked,
                        capitalize_sentences: document.getElementById('autoCapitalize').checked
                    }
                };
                
                console.log('Requesting MP3 generation:', requestData);
                
                // Update progress
                progressBarInner.style.width = '50%';
                
                // Send request to backend with CORS mode
                const response = await fetch(`${BACKEND_URL}/api/tts-mp3`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'audio/mpeg, application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                // Update progress
                progressBarInner.style.width = '80%';
                
                if (!response.ok) {
                    let errorMessage = 'MP3 generation failed';
                    
                    // Try to parse JSON error
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error || errorMessage;
                    } catch {
                        // If not JSON, get text
                        try {
                            const errorText = await response.text();
                            if (errorText) errorMessage = errorText;
                        } catch {
                            errorMessage = `Server error: ${response.status} ${response.statusText}`;
                        }
                    }
                    
                    // Specific error handling
                    if (response.status === 429) {
                        errorMessage = 'Rate limit exceeded. Please wait before generating more MP3 files.';
                    } else if (response.status === 503) {
                        errorMessage = 'TTS service temporarily unavailable. Please try again later.';
                    } else if (response.status === 400) {
                        errorMessage = 'Invalid request. Please check your text and try again.';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                // Check content type
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('audio/mpeg')) {
                    console.warn('Unexpected content type:', contentType);
                    // Continue anyway - might still be audio
                }
                
                // Get audio blob
                const blob = await response.blob();
                
                if (blob.size === 0) {
                    throw new Error('Generated MP3 is empty');
                }
                
                // Update progress
                progressBarInner.style.width = '100%';
                
                // Create filename
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const filename = `speech_${timestamp}.mp3`;
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                // Show file info
                const fileSize = (blob.size / 1024 / 1024).toFixed(2);
                const fileInfo = document.getElementById('fileInfo');
                document.getElementById('fileName').textContent = filename;
                document.getElementById('fileSize').textContent = `${fileSize} MB`;
                fileInfo.style.display = 'block';
                
                // Reset button and hide loading
                setTimeout(() => {
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.disabled = false;
                    showLoading(false);
                    progressBar.style.display = 'none';
                    progressBarInner.style.width = '0%';
                    
                    showMessage('âœ… MP3 downloaded successfully!', 'success');
                    
                    // Show duration estimate
                    const duration = Math.round(text.length / 15);
                    setTimeout(() => {
                        showMessage(`ðŸ“ File: ${filename} | Size: ${fileSize} MB | Duration: ~${duration}s`, 'info');
                    }, 1000);
                }, 500);
                
            } catch (error) {
                console.error('MP3 download error:', error);
                
                // Reset button and hide loading
                const downloadBtn = document.getElementById('downloadBtn');
                const progressBar = document.getElementById('downloadProgress');
                const progressBarInner = document.getElementById('downloadProgressBar');
                
                downloadBtn.innerHTML = '<i class="fas fa-file-audio me-2"></i> Generate & Download MP3';
                downloadBtn.disabled = false;
                showLoading(false);
                progressBar.style.display = 'none';
                progressBarInner.style.width = '0%';
                
                // User-friendly error messages
                let userMessage = error.message;
                
                if (error.message.includes('Failed to fetch')) {
                    userMessage = 'Network error: Cannot connect to TTS server. Please check your internet connection.';
                } else if (error.message.includes('CORS policy')) {
                    userMessage = 'CORS error: Server configuration issue. Please contact administrator.';
                } else if (error.message.includes('rate limit')) {
                    userMessage = 'Rate limit reached. Please wait before generating more MP3 files.';
                } else if (error.message.includes('unavailable')) {
                    userMessage = 'TTS service temporarily unavailable. Please try again in a few minutes.';
                }
                
                showMessage('âŒ ' + userMessage, 'danger');
                
                // Check TTS info for debugging
                setTimeout(() => {
                    checkTTSInfo();
                }, 2000);
            }
        }
        
        // Test Web Speech API
        function testSpeechAPI() {
            if (!checkSpeechSupport()) return;
            
            const testUtterance = new SpeechSynthesisUtterance('Hello, this is a test of the text to speech system. If you can hear this, your browser supports Web Speech API.');
            testUtterance.rate = 1.0;
            testUtterance.pitch = 1.0;
            testUtterance.volume = 1.0;
            
            testUtterance.onstart = function() {
                console.log('Test speech started');
            };
            
            testUtterance.onend = function() {
                console.log('Test speech ended');
                showMessage('âœ… Web Speech API test successful!', 'success');
            };
            
            testUtterance.onerror = function(event) {
                console.error('Test speech error:', event);
                showMessage('âŒ Web Speech API test failed. Check browser permissions.', 'danger');
            };
            
            speechSynthesis.speak(testUtterance);
            return true;
        }
        
        // Show loading spinner
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = show ? 'block' : 'none';
        }
        
        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('statusMessage');
            
            // Remove existing alerts
            const existingAlert = messageDiv.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // Add new alert
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${text}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            messageDiv.appendChild(alertDiv);
            
            // Auto dismiss after 5 seconds for non-error messages
            if (type !== 'danger' && type !== 'warning') {
                setTimeout(() => {
                    if (alertDiv.parentNode === messageDiv) {
                        alertDiv.classList.remove('show');
                        setTimeout(() => {
                            if (alertDiv.parentNode === messageDiv) {
                                messageDiv.removeChild(alertDiv);
                            }
                        }, 150);
                    }
                }, 5000);
            }
        }
    </script>
</body>
</html>
